---
title: Using Logistic Regression to Predict Baseball Playoff Probabilities
author: Matthew Wankiewicz
date: '2021-06-04'
slug: []
categories:
  - R
  - baseball
tags:
  - logistic regression
description: ''
topics: []
bibliography: references.bib
output: blogdown::html_page
---

Code supporting this analysis can be found at: https://github.com/matthewwankiewicz/moneyball

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = F, fig.path = "static")
knitr::opts_chunk$set(warning = F)
#install.packages("tidyverse")
library(tidyverse)
#install.packages("Lahman")
library(Lahman)
#install.packages("cowplot")
library(cowplot)
#install.packages("knitr)
library(knitr)
#install.packages("kableExtra")
library(kableExtra)
```


```{r, message=F}
# read in data
all_years <- read_csv("all_years.csv")
```

# Introduction

In 2003, Michael Lewis wrote a book called Moneyball ^[Moneyball was actually the main reason I decided to get into statistics. Applying baseball with numbers seemed like an absolute Win (Above Replacement) to me.]. Moneyball is the story of the Oakland Athletics who, after losing players to the richer teams in the league, decided to focus on using the misfits of baseball to try to win a World Series. These "misfits" were players who never received support from teams because their traditional stats didn't look good but they excelled in the "advanced" stats that mattered.

In this report, I will use logistic regression to test if the basis of Moneyball was correct, can you throw payroll out the window and just focus on advanced statistics? Is it possible to build a cost-effective team that will make the playoffs in a baseball season? I decided to put the benchmark of a successful season at making the playoffs because once a baseball team makes the playoffs, anything can happen. Often times, teams will just barely make the playoffs and still be able to win the championship, like the 2019 Washington Nationals. 

In order to conduct this analysis using logistic regression, I have set the response variable to whether the team makes the playoffs and the predictors are various advanced metrics. The metrics I plan to use include weighted on-base average (wOBA), fielding independent pitching (FIP), opponent batting average on balls in play (oBABIP), walks plus hits divided by innings pitched (WHIP) and strikeout rate (SO%). Although these metrics may look confusing, I will explain what they mean and how to calculate them in the data section of the report.

After using the model, we find that the advanced metrics are fairly accurate in predicting a team's success, displaying an 88% accuracy. These results are significant because it shows that the statistical revolution displayed in Moneyball should be here to stay. Over the last few years, many teams have increased their budgets for analytics and those teams are appearing to be more successful than others. In a FiveThirtyEight article from 2016, it is shown that only 3 teams had analytics departments with more than eight people (@cite538) and two of those teams were the best teams in baseball last year. This result helps confirm the purpose of the model, showing that advanced analytics can lead teams to more success.

From this analysis, you will see that advanced analytics is a better way of predicting a team's chance of making the playoffs, compared to their payroll. This finding is not only important for teams with less money that want to find a way to win against the larger market teams but can also give a roadmap of how the larger teams should spend their money. Often times, players have one strong season with traditional stats and are then signed to massive contracts and in the next few seasons, the player never plays like they did before the contract. Using the advanced metrics discussed in this paper, teams can see which players will best increase their chances of making the playoffs and invest in those players.

The data collected for this analysis was from the `Lahman` package in R (@citeLahman) and Baseball-Reference (@citebbref). Fangraphs (@citefangraphs) was also used to help calculate one of the statistics. 

This data analysis was conducted using R (@citeR), and in particular, the packages Tidyverse (@citeTidyverse) and Cowplot (@citecowplot) were used. The report was compiled using R markdown (@citermarkdown) and Knitr (@citeknitr). This paper includes 4 sections not including the introduction. The first section covers the data I used for my report, including a few plots to show how the distributions and relationships between various stats. The next section is about the model I used, this will include an explanation of logistic regression. Next, I will display the results of my model, this will include the coefficients of the model and a brief interpretation of the model, along with an application of the model to see how accurate its predictions are. Lastly, there is a section discussing what we learn from this model and some next steps. Was Moneyball right? Can advanced metrics lead a team to the playoffs?


# Data

The data collected is from the `Lahman` package in R (@citeLahman). The `Lahman` package contains yearly player statistics going all the way back to the late 1800s. For this project, I will only use the data from 1920 and onward because those years have the most observations for statistics like payroll data. When looking for payroll data, I found that some years did not have complete payroll data for all teams so these observations were removed. After removing the years with missing entries, there were 2096 observations present for this analysis. In the `Lahman` package, there are many different datasets present, for this project I will be using the `Teams` dataset. In order to collect the payroll data, I created a scraper that collected yearly team stats from Baseball-Reference (@citebbref). The scraper takes the data from each year and saved it into a larger dataset ^[This scraper can be found in the scripts folder of my GitHub repo.]. The payroll data will be crucial for my report because the basis of Moneyball is fielding the best possible team by spending the least amount of money. 

As mentioned above, the `Lahman` package contains the `Teams` dataset which was used for the calculation of the basic statistics along with the more advanced ones. The `Teams` data contains observations from all the way back to 1871, but as mentioned above, this analysis will focus on 1920 to 2019. The issue with going back this far in the past is that the methods of observations were changed. This is because the maintainers take old newspaper articles and box scores and record them into the data so the data they use is from how the data was collected in the past. A major example of this is in the recording of certain statistics like Sacrifice Hits (SF) or recording if a batter was hit by a pitch (HBP). For this analysis, I replaced all of the missing values with 0's because the impact of these statistics on the advanced metrics we plan to use are minimal and it is likely that stats like HBP were just included in regular walk stats. 

There aren't any concerns with how the data was collected other than the ones mentioned above. I don't have any concerns with it because the definitions for what a hit or home run has not changed over time.

The statistics used for this analysis were Fielding Independent Pitching (FIP), Weighted on-base average (wOBA), batting average balls in play of the opponents (oBABIP), walks plus hits divided by innings pitched (WHIP) and the strikeout rates (K%). The metrics used for this analysis will be explained below.

- **wOBA**: Weighted on-base average is considered to be a "better" version of a batting average. wOBA was created by Tom Tango and he writes more in-depth about it in "The Book" (@citetango).^[The Book is seen as the best book for aspiring baseball analysts or "saberists" to get into the MLB analysis game. I highly recommend it.] wOBA is a weighted average of each of the ways a player can get on base (walking, getting a single, double, triple and a home run) and is divided by the ways a player gets a chance to hit (at-bats, walks and sacrifice flies). Usually the coefficients of wOBA change by year but for this report, I used a manipulation of other advanced statistics that were described in "The Book", $(2*OBP + SLG) / 3$ ^[OBP is on-base percentage, the rate a player gets on base (includes walks). SLG is slugging percentage, the total bases (TB) a player gets divided by at-bats (a single = 1 TB, double = 2, triple = 3 and Home Run = 4).]

- **FIP**: Fielding independent pitching estimates a player's run prevention if they did not have a defence behind them, as opposed to ERA (explained below) which includes defence. The equation for FIP is simple, $(13*HRA + 3*BBA - 2*SOA)/IP$ where HRA is home runs allowed, BBA is walks allowed, SOA is the number of strikeouts a player gets and IP is the number of innings pitched. As Fangraphs says, "FIP is a measurement of a pitcherâ€™s performance that strips out the role of defense, luck, and sequencing, making it a more stable indicator of how a pitcher actually performed over a given period of time" (@citeFIP).

- **oBABIP**: Opponent batting average on balls in play is pretty much the opposite of FIP. It looks at the batting average of only the balls that the defence has to field, as opposed to FIP which only looks at outcomes that the defence cannot control. The equation for oBABIP is $(HA-HRA)/(IPouts - SOA - HRA)$ where HA is hits allowed, HRA is home runs allowed, IPouts is the number of outs a team gets while pitching and SOA is the number of strikeouts a team gets while pitching.

- **WHIP**: Walks plus hits divided by innings pitched is kind of self-explanatory. It takes the number of walks a team gives up, plus the number of hits and divides it by the number of innings pitched: $(BBA + HA)/IP$. WHIP is useful because it tells us how good a team (or pitcher) is at preventing runners from getting on base. If a team allows more people to get on base, they are more likely to give up runs and lose a game.

- **SO%**: Strikeout rates tell us how often a team (or batter) strikes out when they are batting. Some players tend to only hit the ball far or not hit it at all while other players hit the ball almost all of the time. SO% helps show what type of gameplay a team relies on and it will be interesting to see how it affects a team's playoff chances. To calculate SO% we take the number of strikeouts a team gets while batting and divide that by the number of times they bat $SO/AB$.

- **ERA**: Earned Run Average represents the number of runs a player gives up over a full game. Although I will not be including it in my model, I will be using it to show why FIP is a good metric so I thought it would be best to describe it. ERA is the traditional measure of success for pitchers and if they have a low ERA, they're seen as great players. 

Now that the metrics we're focusing on have been discussed, we can look at some plots to help visualize the data.

```{r payroll, echo=F, fig.cap="The increase in Payroll over the Years", fig.height=4}
# create plot for payroll vs year
all <- all_years %>% 
  ggplot(aes(x = yearID, y = payroll_adj, color = as.factor(playoffs))) +
  geom_point() +
  labs(title = "Payroll vs Year",
       x = "Year",
       y = "Payroll",
       color = "Playoffs") +
  scale_color_manual(values = c("grey", "blue"), labels = c("No", "Yes")) +
  theme_classic()
# plot for payroll vs year, before 75
before <- all_years %>% 
  filter(before_75 == 1) %>% 
  ggplot(aes(x = yearID, y = payroll_adj)) +
  geom_point(aes(color = as.factor(playoffs))) +
  labs(title = "Payroll vs Year",
       x = "Year",
       y = "Payroll",
       subtitle = "Before 1975",
       color = "Playoffs") +
  scale_color_manual(values = c("grey", "blue"), labels = c("No", "Yes")) +
  theme_classic()
# plot for payroll vs year, after 75
after <- all_years %>% 
  filter(before_75 == 0) %>% 
  ggplot(aes(x = yearID, y = payroll_adj, color = as.factor(playoffs))) +
  geom_point() +
  labs(title = "Payroll vs Year",
       x = "Year",
       y = "Payroll",
       subtitle = "After 1975",
       color = "Playoffs") +
  scale_color_manual(values = c("grey", "blue"), labels = c("No", "Yes")) +
  theme_classic()
# plot the graphs together
bottom <- plot_grid(before, after)
plot_grid(all, bottom, nrow = 2)
```

Figure \@ref(fig:payroll) shows us the increase in payroll over the years, starting at 1920 and ending at 2019. We see that up until 1960, payrolls were fairly constant but after the 60s we have seen a rapid increase in payroll. We can also see colours which represent if a team made the playoffs or not (light blue representing yes and dark blue meaning no). It is clear that in most seasons, teams that spend more make the playoffs. The salaries have been adjusted to represent the dollar in terms of what it would be in 2019 using inflation rates from the US Inflation Calculator (@citeUSINF). Clearly, the adjustment does not do much as we see that teams were likely just spending more compared to the past.

```{r offense, fig.cap="Relationship between Advanced Offense Metrics and Wins"}
# find average number of wins to make playoffs, will be used for future plot
playoff_teams <- all_years %>% filter(playoffs == 1)
avg_wins <- mean(playoff_teams$W)
# create plot for woba vs wins
woba <- all_years %>% 
  ggplot(aes(W, wOBA, color = as.factor(playoffs))) + 
  geom_vline(xintercept = avg_wins, linetype = "dashed", color = "green") +
  labs(title = "wOBA vs Wins",
       x = "Wins",
       color = "Playoffs") +
  scale_color_manual(values = c("grey", "blue"), labels = c("No", "Yes")) +
  theme_classic() +
  geom_point(alpha = 0.5) +
  geom_vline(xintercept = avg_wins, linetype = "dashed", color = "green")
# create plot for strikeout rate vs wins
so_rate <- all_years %>% 
  ggplot(aes(W, SO_rate, color = as.factor(playoffs))) + 
  geom_point(alpha = 0.5) +
  labs(title = "Strikeout Rate vs Wins",
       x = "Wins",
       y = "Strikeout Rate",
       color = "Playoffs") +
  scale_color_manual(values = c("grey", "blue"), labels = c("No", "Yes")) +
  theme_classic() +
  geom_vline(xintercept = avg_wins, linetype = "dashed", color = "green")
# plot graphs
plot_grid(woba, so_rate, 
          nrow = 2)
```

Figure \@ref(fig:offense) shows the relationship between the offensive advanced metrics and the amount of teams a win gets, along with colours representing a team's ability to make the playoffs. From the first graphs, we see that as wOBA increases, the amount of wins increases and the number of teams making the playoffs increases as well. We also see that there does not appear to be too much of a relationship between the number of wins a team gets and their strikeout rate. This makes sense because some teams are built on hitting home runs and strikeout a lot, versus teams who play more strategically and don't hit the ball as hard. 

I have also added a green line at the amount of wins that teams generally make the playoffs. For teams that made the playoffs, they had an average of about 94 wins. 

```{r pitching, fig.cap="Relationship between Advanced Pitching Metrics and Wins"}
# create plot for FIP vs wins 
fip <- all_years %>% 
  ggplot(aes(W, FIP, color = as.factor(playoffs))) + 
  geom_point(alpha = 0.4) +
  labs(title = "FIP vs Wins",
       x = "Wins",
       color = "Playoffs") +
  scale_color_manual(values = c("grey", "blue"), labels = c("No", "Yes")) +
  theme_classic() +
  geom_vline(xintercept = avg_wins, linetype = "dashed", color = "green")
# create plot for WHIP vs wins
whip <- all_years %>% 
  ggplot(aes(W, WHIP, color = as.factor(playoffs))) +
  geom_point(alpha = 0.4) + 
  labs(title = "WHIP vs Wins",
       x = "Wins",
       color = "Playoffs") +
  scale_color_manual(values = c("grey", "blue"), labels = c("No", "Yes")) +
  theme_classic() +
  geom_vline(xintercept = avg_wins, linetype = "dashed", color = "green")
pitch1 <- plot_grid(fip, whip)
# create plot for oBABIP vs wins
babip <- all_years %>% 
  ggplot(aes(W, oBABIP, color = as.factor(playoffs))) +
  geom_point(alpha = 0.5) +
  labs(title = "oBABIP vs Wins",
       x = "Wins",
       y = "BABIP against",
       color = "Playoffs") +
  scale_color_manual(values = c("grey", "blue"), labels = c("No", "Yes")) +
  theme_classic() +
  geom_vline(xintercept = avg_wins, linetype = "dashed", color = "green")
# plot graphs
plot_grid(pitch1, babip,
          nrow = 2)
```


Figure \@ref(fig:pitching) shows the relationship between some advanced pitching metrics and the amount of wins a team gets in a season. We see that WHIP appears to have a very strong impact on wins and if a team can keep their WHIP as low as possible, they're more likely to make the playoffs. It appears that FIP has the next strongest relationship with wins, better teams have lower FIPs. Lastly, it appears that BABIP against does have an impact on the amount of wins a team gets, just not as significant as FIP and WHIP. Once again, the green line represents the average amount of wins a playoff team gets.

```{r wins, message=F, warning=F, fig.cap="Distribution of Wins for Lahman data", fig.height=4}
# create histogram for distribution of wins
all_years %>% 
  ggplot(aes(W, fill = as.factor(playoffs))) +
  geom_histogram() +
  scale_fill_manual(values = c("grey", "blue"), labels = c("No", "Yes")) +
  labs(title = "Distribution of Wins in the Lahman Data",
       x = "Wins",
       y = "Count",
       fill = "Playoffs",
       subtitle = "Green line represents average amount of wins for playoff team") +
  theme_classic() +
  geom_vline(xintercept = avg_wins, linetype = "dashed", color = "green")
```

Figure \@ref(fig:wins) shows the distribution of wins for teams present in the Lahman data. We see that majority of teams make the playoffs when they win over 90 games although there is some spread in the distribution of wins for playoff teams. There are also some teams present which made the playoffs after winning less than 75 games. This occured because of dispute between the players and the league which led to a 50 day strike and led to teams winning less games in total (@cite1981)^[The players eventually returned and the playoffs continued]. 

# Model

In order to get playoff probabilities, I will use logistic regression. Logistic regression is a type of statistical modelling which is used when the variable you are trying to predict is binary (only two options). Logistic regression is best used to model binary variables because instead of predicting a certain value, it gives the probability that an event will occur. For this report, logistic regression is used to determine the probability that a team will make the playoffs. Logistic regression is similar to other types of regression, where $\beta$ values are assigned for each $x_i$. It then takes the sum of these factors and, after manipulating the equation, we will end up with a probability. The logistic regression will be in the form:

\begin{equation} 
  log(\frac{\hat{p}}{1 - \hat{p}}) = \beta_{0} + \beta_{1}x_{FIP} + \beta_{2}x_{wOBA} +
  \beta_{3}x_{oBABIP} + \beta_{4}x_{WHIP} + \beta_{5}x_{SOrate} + \beta_{6}x_{before75} + \beta_{7}x_{payroll}
  (\#eq:logit)
\end{equation} 

where $x_{FIP}$ represents the team's FIP, $x_{wOBA}$ represents the team's wOBA, $x_{oBABIP}$ represents the team's BABIP against, $x_{WHIP}$ represents the team's WHIP, $x_{SOrate}$ represents the team's strikeout rate, $x_{before75}$ represent whether the team in question was playing before 1975 or not and $x_{payroll}$ represents the team's payroll. The variable `before_75` was added to the model, to help create different slopes for teams that played in the two different eras, this was done because there was a rapid increase in payroll around that time. All of the variables are numerical variables except for `before_75` which is binary. The variables for this model were kept as numeric and were not grouped because there is a lot of variation in the metrics used for the analysis. With some of the ways the metrics are classified (determining what is good and bad), the intervals are usually only separated by 0.03 points. I believe it would be easier for the model and for calculations and interpretations, to keep the variables as numeric. 

In Equation \@ref(eq:logit), the $\beta$ values represent a coefficient determined by the `glm` function, they will either be positive or negative, depending on if a higher $x_i$ value increases or decreases a team's chances of making the playoffs. Each $\beta$ value will be multiplied by its corresponding x, for example, as we saw in the data section, teams with higher wOBA's tend to make the playoffs more often, so the $\beta$ value for $x_{wOBA}$ will likely be positive. Once all of the coefficients are multiplied we take the sum of the equation and insert it into the equation below:

\begin{equation} 
  \frac{e^{sum}}{1+e^{sum}}
  (\#eq:prob)
\end{equation} 

Equation \@ref(eq:prob) is just a manipulation of equation \@ref(eq:logit), where $e$ is the exponential equation and $sum$ is the sum of the right side of equation \@ref(eq:logit). We can see that as the sum of the equation increases, the probability of a team making the playoffs increases as well. 

The logistic regression model is run using the `glm()` function in R (@citeR). The decision to run this model over other models like linear regression was made by the fact that we are predicting a binary variable of a team's success in the season. Since there are only two possible options our data will likely follow an S shape. This is one of the benefits of using logistic regression because it allows us to capture as many points as possible because of how flexible the equation can be. Another benefit is that we get a probability which, in a way, shows how confident that the model is that a team will make the playoffs. For this report, I counted teams that had a probability of over 50% playoff probability as making the playoffs. So if a team with a probability of 50% does not make the playoffs, it wouldn't be as concerning as a team with a 90% probability not making it.

Another option for a regression line would have been linear regression. In this case, instead of getting a probability, we would get a value (1 or 0). This type of regression would not work well when modelling a team's ability to make the playoffs because the regression line would likely miss most of the data points.

While logistic regression does work well for this scenario, there are some flaws that limit what we can do with it. Since logistic regression works for binary variables, we can only use variables that have yes or no answers, like "did a team make the playoffs?" This limits our analysis because it would be useful to determine if a team made the playoffs as the best team in the league or they just barely made it. 

```{r model}
# create glm model
model <- glm(playoffs ~ FIP + wOBA + oBABIP + WHIP + SO_rate +
               before_75 + payroll_adj,
             data = all_years, family = binomial())
# save coefficients
coefficients <- broom::tidy(model)
```

```{r cooks, fig.cap="Cook's Distance for the Model"}
# plot cooks distance
plot(model, which = 4)
```

Figure \@ref(fig:cooks) shows us the observed cook's distances for the model. Cook's distance tells us how far a point is from the predicted value of it, telling us which points negatively impact our model. We see that these cook's distances are very low (most are under 0.01), since our distances are fairly low, we can conclude that the model is fitting the data well. After some investigation, it appears as though the data points with the higher values were teams that made the playoffs when their stats said that they shouldn't. 

# Results

```{r coefficients}
# display coefficients as a table
coefficients %>% 
  kable(digits = 5,
        caption = "Regression Model Coefficients") %>% 
  kable_styling(latex_options = "hold_position")
```

Table \@ref(tab:coefficients) shows us the coefficients from our logistic regression model^[Created using the `tidy` function from the `broom` package (@citebroom)]. We can see that all variables have statistically significant p-values, meaning that we know for sure that the variables have an effect on a team's playoff chances (P-values will be explained more in depth under Figure \@ref(fig:pvalues)). An important point to note from Table \@ref(tab:coefficients) is that the p-value for payroll is less significant than the advanced metrics. This means that although it is significant to predicting success, we are less confident in its abilities compared to the advanced metrics.

Using the coefficients displayed in Table \@ref(tab:coefficients), the regression equation we end up with is:

**Equation 3:**

$$
\begin{aligned} 
  log(\frac{\hat{p}}{1 - \hat{p}}) = -6.7 - 2.86x_{FIP} + 113.29x_{wOBA} -
  38.71x_{oBABIP}\\
  - 8.19x_{WHIP} + 10.3x_{SOrate} - .4x_{before75} + 6.07*10^{-09}x_{payroll}
\end{aligned} 
$$

From Equation 3 we can see that having a high FIP, WHIP, and oBABIP will lead to a lower chance of making the playoffs. But, if teams get a higher wOBA and SO_rate, they have a higher chance at making the playoffs.

We can also see that using equation 3, the lowest possible probability of making the playoffs is $2.73*10^{-6}$ percent. This was calculated using the worst possible stats present in the data used. The highest possible probability of making the playoffs is 99.99 percent. This was taken from the maximum stats present in the data, and although it would be tough for a team like this to exist, there have been some teams that were close. 

```{r pvalues, fig.cap="P-values of the terms of the regression equation", fig.height=2.5}
# create plot figure for the p-values from the model
coefficients %>% 
  ggplot(aes(term, p.value)) +
  geom_bar(stat = "identity") +
  labs(title = "P-values from the Regression Model",
       x = "Term",
       y = "P-value",
       subtitle = "Red line shows cut-off mark") +
  theme_classic() +
  geom_hline(yintercept = 0.05, color = "red", linetype = "dashed")
```

Figure \@ref(fig:pvalues) shows the p-values of all terms used in the regression equation. A p-value is run under a hypothesis that says a variable has no impact on what it is trying to predict. If the p-value is small, it implies that the variable has a significant impact. In most cases, we use a significance level of 0.05 to determine if a variable is significant and that is what I will be using. If the p-value is under 0.05, we can conclude that the variable is significant. We see that `before_75` has the highest p-value while FIP, oBABIP and wOBA all appear to have p-values that are pretty much 0.


```{r result}
# create new dataframe so we can display prediction
all_years_predict <- all_years
# create estimate to determine teams chance of playoffs
all_years_predict$estimate <- predict.glm(model, newdata = all_years,
                                          type = "response")
# create function that give 1 for team making playoffs, 0 for not
all_years_predict <- all_years_predict %>% 
  mutate(playoffs_predict = ifelse(estimate > 0.5, 1, 0))
# match predictions with actual results to test for accuracy
all_years_predict <- all_years_predict %>% 
  mutate(accuracy = ifelse(playoffs_predict == playoffs, 1, 0))
# actual playoff percentage
data <- sum(all_years_predict$playoffs)/nrow(all_years_predict)
# predicted playoff percentage
model_pred <- sum(all_years_predict$playoffs_predict)/nrow(all_years_predict)
# display accuracy of model
accuracy <- c("-", sum(all_years_predict$accuracy)/nrow(all_years_predict) * 100)
# formatting for a table to display results
type <- c("Data", "Model")
result <- c(data, model_pred)
props <- tibble(type, result) %>% cbind(accuracy)
props <- props %>% 
  mutate(result = result * 100) %>% 
  rename("Data Type" = type,
         "Accuracy (%)" = accuracy)
# plot table
props %>%  
  kable(digits = 3, 
        caption = "Accuracy of the Model") %>% 
  kable_styling(latex_options = "hold_position")
```

Table \@ref(tab:result) displays the proportion of teams that made the playoffs from the observed data vs the results of our model's predictions. We can see that the model is very strict with its results, only predicting about 15 percent of teams to make the playoffs, less than the observed 18.9 percent. 

We can also look at the overall accuracy of the model. In order to find the accuracy of the model, I compared the predicted results to the actual results and we find that the model successfully predicted if a team would make the playoffs about 88 percent of the time. These results are very significant because it shows that the model can fairly successfully determine what a playoff team is.

# Discussion

Now that the model has been created (and tested) and we have our results, what can we make of them? Well, the first major point we can see is that when using advanced statistics, we can accurately predict if a team will make the playoffs 88 percent of the time. This result is truly significant because it means that if a team puts their focus on acquiring players who excel in advanced statistics but are average in the 'regular' ones, they can drastically improve their chances of making the playoffs. We also see from Table \@ref(tab:result) that in the original data, about 19 percent of teams made the playoffs while the model's predictions only had predicted about 15 percent of teams to make it. This makes sense because there are usually outliers in seasons, where teams who appear to not have a chance at making the playoffs defy the odds and make it. We can also observe the opposite, really good teams not making the playoffs because there aren't enough spots. There have been many teams in the past that have won over 100 games in a season but since there were fewer playoff spots available, like the 1993 San Francisco Giants who won 103 games but still missed the playoffs (@adler_2019).

When looking at our batting stats, we see that wOBA is very influential in determining a team's playoff status. As we see in table \@ref(tab:coefficients), the p-value for wOBA's influence on playoff chances is practically 0. If teams are still evaluating players using traditional statistics, they have a much higher chance of paying for a player who may not have a significant impact on their playoffs chances compared to players who excel in the advanced metrics. Taking a quick look at Fangraphs' wOBA leaderboard from 2019^[We're going to focus on 2019 because the 2020 season was just a really small sample size.] we see that 6 of the top 10 players in wOBA were not in the top 10 for batting average. This shows that some of the players that would be looked at as elite according to the advanced metrics can be overlooked by teams that focus on the traditional stats and if teams make the shift to stats like wOBA, they certainly won't be hurting their chances at making the playoffs. 

We can also take a look at the strikeout rate of teams. As we saw in Figure \@ref(fig:offense), it didn't appear as if a team's strikeout rate had any impact on the number of games a team won. This makes sense due to the various play styles that have been popularized over the years. Some teams have adopted the style of 'go big or go home' when they go up to bat, either hit a home run or strikeout. This type of play has been fairly popular over the past few years and was especially popular during the "Steroid Era" in the early 2000s when the league saw a rise in offence due to steroids (@citeeras). The p-value displayed in Table \@ref(tab:coefficients) and Figure \@ref(fig:pvalues) shows that having a high strikeout rate improves a teams chances of making the playoffs, so according to the model, the go big or go home strategy appears to lead to success. This does make sense because some of the teams that strike out a lot, do hit a lot of home runs and because of that, they will outscore their opponents easily.

Next, we can also take a look at FIP, now that we know it is significant. FIP is much more difficult to evaluate compared to the traditional stats because of how it is calculated. As we saw in the data section, FIP is calculated only by true outcomes: home runs, strikeouts and walks. Since FIP only deals with these "true outcomes", it tends to overlook players who don't rely on strikeouts but instead rely on their teammates to help them out. Regardless, finding players with an above-average FIP^[under about 4.20] and below-average traditional metrics is fairly simple. Once again, from Fangraphs, we find that there are many pitchers with high ERAs and above-average FIPs. This is significant because FIP predicts success better than other metrics. In a Sporting News article from 2017, John Edwards talks about a player named Michael Pineda's 2016 season. He started the season with a high ERA but a low FIP and as the season went on, his ERA began to decrease (@citeSN). Since he didn't excel in some of the traditional stats, some teams may have given up on a player like Pineda and have the potential of losing games because of it. This is one of many examples where FIP is more valuable than the traditional statistics and shows why it should be emphasized when evaluating teams and players.

We can talk about oBABIP and WHIP together because they both yield similar results. As shown in Figure \@ref(fig:pitching), having lower oBABIPs and WHIPs both lead to teams winning more games and thus increasing their chances of making the playoffs. This result is confirmed by Table \@ref(tab:coefficients) because of their negative term. This means that as the pitching numbers increase, the teams will have less of a chance of making the playoffs and both these metrics are backed up by very significant p-values (Figure \@ref(fig:pvalues)). These two metrics have a similar argument to that of FIP where if a team allows less runs, they'll win more games and in turn, will make the playoffs. 

Finally, we can look at a team's payroll and how that impacts their playoff chances. Figure \@ref(fig:payroll) shows us that along with the increasing payrolls, teams that had higher payrolls appeared to make the playoffs more often than teams who didn't. We see that in Table \@ref(tab:coefficients), the coefficient for payroll is 0, but upon further inspection, it is greater than 0 and is positive. This is likely because the lowest payroll after making the adjustments was about 780 thousand. This means that for the variable to not completely shift the model's results, it should be very small. Regardless, since the coefficient is small (but positive), we can conclude that according to the model having a higher payroll increases a team's chances. This makes sense because one of the only reasons teams spend more money to try and compete and make the playoffs. We also see in Figure \@ref(fig:pvalues) that other than the variable `before_75`, `payroll` has the highest p-value. This is interesting because it shows that we are more confident that the advanced metrics we have been looking at the impact a team's playoff chances more than payroll does. 

We must also acknowledge though that the advanced metrics may not be the gold standard for improving teams. In a FiveThirtyEight article, the authors find that the cinderella stories of teams winning with low payrolls are just outliers and the general trend is that spending more increases your winning percentage (@citepayroll538). This makes me wonder about how we can interpret these results now, maybe, teams should not be focusing on spending less and winning but instead, it should be about spending smart and winning. The authors of the article do mention that although spending more money does improve your chances of winning, "imcompetent spending" does not. This could also explain the relatively high p-value for the payroll variable because many teams will sign players and those players never live up to the contract.

Another issue that can stem from the pursuit of players using advanced metrics is the fact that some General Managers will want to hold onto players that strong analytic front offices want. There have been many players that the Tampa Bay Rays have acquired and almost instantly turned them into superstars. The most recent story was Randy Arozarena who was acquired by Tampa Bay in exchange for one of their top prospects (among others). He played fairly well in the regular season but once he reached the playoffs he went to another level and broke many playoff records (@berry_2020). There are numerous stories like this from Tampa Bay and these occurrences have even led people to say "Don't trade with Tampa Bay" because you won't win (@doolittle_2019)^[This article is behind a pay-wall, but it's very likely that there is only good things said about Tampa.]. Teams that get calls from the Rays may be hesitant to trade their prospects or other players after these stories because it's clear that the talent is present, but the Rays somehow bring out the best in the player. The story of the Rays shows one of the drawbacks of being good with analytics because it will eventually become difficult to get the players you want in trades.

Regardless, our findings show that the basis of Moneyball was in fact, correct. This is displayed from the surprisingly strong accuracy displayed in Table \@ref(tab:result), to the very significant variables from Table \@ref(tab:coefficients). The point is also validated by the fact that payroll's p-value is the highest of the variables, implying that the model believes more in using advanced metrics to predict playoff probabilities as opposed to payroll.

## Weaknesses and Next Steps

This analysis has had some great results, but there are some weaknesses we must address which may have impacted the analysis. Firstly, it would have been more preferable to have a larger data set. As mentioned in the data section, I had to remove entries because of the missing payroll data and even before that, there were only about 2200 observations. Ideally, we would want more observations but since only 30 teams play each year, we have to make it work. Another weakness I encountered was that the payroll data did not fully translate from 1920 to 2019. Even though I did adjust the payrolls to account for inflation of the dollar, there was still a large difference in spending now compared to 100 years ago. This just shows that teams decided to spend more money than they did in the past but this was accounted for in the model by adding a term to tell us if the team played before 1975 (just after the spike in pay began). If spending habits were a little more constant over the years, we may have yielded different results from the analysis.

When looking at potential future steps for analyses after this one, there are many different routes we can take. One potential route we could take is looking at the statistical value of a single player's contract and also look at their statistical impact on the team. This analysis looked at the impact of a whole team's payroll and performance but going in-depth on a player's impact would certainly be an interesting topic to research. Another topic we could look at is using this model to predict the next season's results. Right now the model is constructed to use current-year metrics to predict playoff probabilities for that same season, but if it was possible to predict expand that to the next season, it would once again be an amazing application of the model. Lastly, the advanced metrics used for this analysis were some of the more basic ones present in baseball today. In the future, it may be useful to determine if there is a relationship between how teams throw/hit the ball and their success. The `baseballr` package in R (@citebaseballr) contains a scraper that collects data from MLB's statcast data which looks at things like launch angle and exit velocity along with other useful data. Seeing if there is a relationship between teams that excel in statcast data and their success would be useful, especially because it seems like the MLB is moving in that direction.


# References